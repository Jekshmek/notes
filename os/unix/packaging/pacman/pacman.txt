https://wiki.archlinux.org/index.php/pacman
https://wiki.archlinux.org/index.php/Pacman_Rosetta
https://wiki.archlinux.org/index.php/Pacman-key

https://wiki.manjaro.org/index.php?title=Pacman_Tips
https://wiki.manjaro.org/index.php?title=Pacman_troubleshooting


Query a SYNC package DB:
pacman -S --help

pacman -S <package
  install package (docky)

pacman -Syu
  y --refresh    - download and refresh sync database
  u --sysupgrade - upgrade all the outdated

pacman -Ss <search-str>
  search all the package by string


Query local package DB:
pacman -Q --help

pacman -Qs <package>
  search locally installed package for names or descriptions
  if <package> is absent - list all the installed packages

pacman -Qo /path/to/file_name
  which package a file belongs to

pacman -Qi <package> <package>
  extensive info about the installed package

pacman -Ql <package>
  list all the files of package

pacman -Qdt
  list all packages no longer required as dependencies (orphans)



Remove packages:
pacman -R --help

pacman -Rns <package>
  remove with config files [and dependencies]


Config files:
/etc/packman.conf

# disable signature checking
SigLevel = Never

for [almost] all the occurences

# Pacman won't upgrade packages listed in IgnorePkg and members of IgnoreGroup
#IgnorePkg = <p1> <p2> ...


pactree <package>
whoneeds <package>
makepkg

pacman-mirrors -g -b stable
pacman-mirrors -g -b testing


Package cache:
https://wiki.manjaro.org/index.php?title=Maintaining_/var/cache/pacman/pkg_for_System_Safety

/var/cache/pacman/pkg

yaourt -S pkgcacheclean
sudo pkgcacheclean <N>


Downgrading:
https://forum.manjaro.org/index.php?topic=4566.0

ls -l /var/cache/pacman/pkg/ | grep xf86-video-intel
sudo pacman -U /var/cache/pacman/pkg/xf86-video-intel-2.99.911-2-x86_64.pkg.tar.xz



Package format:

Sample: user creation at deluge:

.INSTALL file at the package:

post_install() {
  getent group deluge &>/dev/null || groupadd -g 125 deluge
  if ! getent passwd deluge &>/dev/null; then
    useradd -c 'Deluge user' -u 125 -g deluge -d /srv/deluge -s /bin/false deluge
    passwd -l deluge &>/dev/null ### !!! locked account
  fi

  post_upgrade
}

post_upgrade() {
  [[ -x /usr/bin/xdg-icon-resource ]] && xdg-icon-resource forceupdate --theme hicolor
  [[ -x /usr/bin/update-desktop-database ]] && update-desktop-database -q
  true
}

post_remove() {
  getent passwd deluge &>/dev/null && userdel deluge
  getent group deluge &>/dev/null && groupdel deluge

  post_upgrade
}

# user dirs
/var/lib/...
/src/...

